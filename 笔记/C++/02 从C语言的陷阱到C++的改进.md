# C语言字符语法常见陷阱

![](image/Pasted%20image%2020220915103601.png)

![](image/Pasted%20image%2020220915104536.png)

```cpp
#include <iostream>  
#include <string>  
using namespace std;  
int main() {  
  char c1 = 'yes'; // 截断：1.保留第一个字符； 2.保留最后一个字符；  
  cout << c1 << endl;         // s  
  char c2 = 'y'; //"y" ==> 'y', '\0'  
  //char c2 = "yes"; // 字符串赋值给一个字符变量  
  
  const char *slash = "/"; // ==> '/', '\0'  
  //const char* slash2 = '/';  const char *slash2 = &c1;  
  cout << *slash2 << endl; // s  
  
  string s1(1, 'yes');  
  cout << s1 << endl;         // s  
  string s2(3, 'yes');  
  cout << s2 << endl;         // sss  
  string s3(1, 'y');  
  cout << s3 << endl;         // y  
  string s4("/");  
  cout << s4 << endl;         // /  
  string s5(1, '/');  
  cout << s5 << endl;         // /  
  string s6("yes");  
  cout << s6 << endl;         // yes  
  
  return 0;  
}
```

# C语言指针和数组问题

![](image/Pasted%20image%2020220915111357.png)

```cpp
#include <iostream>  
#include <vector>  
using namespace std;  
  
double average1(int *arr) {  
  double result = 0.0;  
  int len = sizeof(arr) / sizeof(arr[0]);  
  //cout << "In average1:  " << len << endl;  
  
  for (int i = 0; i < len; i++) {  
    result += arr[i];  
  }  
  return result / len;  
}  
  
double average2(int *arr, int len) {  
  double result = 0.0;  
  //int len = sizeof(arr) / sizeof(arr[0]);  
  //cout << "In average1:  " << len << endl;  
  for (int i = 0; i < len; i++) {  
    result += arr[i];  
  }  
  return result / len;  
}  
  
double average3(vector<int> &v) {  
  double result = 0.0;  
  vector<int>::iterator it = v.begin();  
  //auto it = v.begin();  
  
  for (; it != v.end(); ++it) {  
    result += *it;  
  }  
  return result / v.size();  
}  
  
double average2DV(vector<vector<int>> &vv) {  
  double result = 0.0;  
  unsigned int size = 0;  
  
  for (unsigned int i = 0; i < vv.size(); ++i) {  
    for (unsigned int j = 0; j < vv[i].size(); ++j) {  
      result += vv[i][j];  
      size += 1;  
      cout << vv[i][j] << " ";  
    }    cout << endl;  
  }  
  return result / size;  
}  
int main() {  
  int array1[] = {10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110};  
  int len = sizeof(array1) / sizeof(array1[0]);  
  //cout << "In main:  " << len << endl;  
  cout << average1(array1) << endl;  
  cout << average2(array1, len) << endl;  
  
  vector<int> vt{10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110};  
  cout << average3(vt);  
  
  cout << endl;  
  
  vector<vector<int>> vv2D{8, vector<int>(12, 3)};  
  cout << average2DV(vv2D);  
  
  return 0;  
}
```

# C语言的移位问题

![](image/Pasted%20image%2020220915180022.png)

![](image/Pasted%20image%2020220915180106.png)

```cpp
#include<cstdio>  
#include <bitset>  
#include <iostream>  
using namespace std;  
  
int main() {  
  /*  
  char a1 = 0x63;       // 0110 0011  
  a1 = (a1 << 4);        // 0011 0000  
  printf("0x%x\n", a1);
    
  a1 = 0x63;                // 0110 0011  
  a1 = (a1 >> 4);        //  0000 0110 逻辑右移  
  printf("0x%x\n", a1);  
  
  char a2 = 0x95;       // 1001 0101  
  a2 = (a2 << 4);        // 0101 0000  
  printf("0x%x\n", a2); 
   
  a2 = 0x95;                // 1001 0101  
  a2 = (a2 >> 4);        //  1111 1001 算术右移  
  printf("0x%x\n", a2);  
  
  unsigned char a3 = 0x63;       // 0110 0011  
  a3 = (a3 << 4);        // 0011 0000  
  printf("0x%x\n", a3);  
  
  a3 = 0x63;                // 0110 0011  
  a3 = (a3 >> 4);        //  0000 0110 逻辑右移  
  printf("0x%x\n", a3);  
  
  unsigned char a4 = 0x95;       // 1001 0101  
  a4 = (a4 << 4);        // 0101 0000  
  printf("0x%x\n", a4);  
  
  a4 = 0x95;                // 1001 0101  
  a4 = (a4 >> 4);        //  0000 1001 逻辑右移  
  printf("0x%x\n", a4);  */  
  
  /*  //0000 0000  
  const unsigned char priv = 0xFF;  
  const unsigned char P_BAKCUP = (1<<6);  
  const unsigned char P_ADMIN = (1<<7);  
  printf("0x%x\n", P_BAKCUP);  
  printf("0x%x\n", P_ADMIN);  
  if (priv & P_BAKCUP)  {      
	  cout << "BAKUP" << endl;  
	  }  
	if (priv & P_ADMIN)  {      
	cout << "ADMIN" << endl;  
	}  */  
  // bitset  bitset<10> priv = 0x7F;  
  bitset<10> P_BAKCUP = (1 << 6);  
  bitset<10> P_ADMIN = (1 << 7);  
  
  cout << priv << endl;  
  cout << P_BAKCUP << endl;  
  cout << P_ADMIN << endl;  
  
  if ((priv & P_BAKCUP) == P_BAKCUP) {  
    cout << "BAKUP" << endl;  
  }  if ((priv & P_ADMIN) == P_ADMIN) {  
    cout << "ADMIN" << endl;  
  }  return 0;  
}
```

# C语言强制类型转换的问题

![](image/Pasted%20image%2020220915183943.png)

![](image/Pasted%20image%2020220915184457.png)

```cpp
#include <iostream>  
using namespace std;  
  
// 1+1/2+1/3+1/4+... +1/n  
double getSum(int n) {  
  double result = 0.0;  
  for (int i = 1; i < n + 1; i++) {  
    //result += 1.0 / i;  
    result += static_cast <double>(1) / i;  
  }  return result;  
}  
  
int main() {  
  //例子一  
  int array[] = {1, 2, 3};  
  cout << sizeof(array) / sizeof(array[0]) << endl;  
  int threshold = -1;  
  int len = static_cast <int>( sizeof(array) / sizeof(array[0]));  
  //if (sizeof(array) / sizeof(array[0]) > static_cast<unsigned int>(threshold))  //发生了一个隐式的类型转换  
  if (len > threshold) {  
    cout << "positive number array" << endl;  
  } else {  
    cout << "negative number array" << endl;  
  }  cout << static_cast<unsigned int>(threshold) << endl;  
  /*  
 // 例子二  // 1+1/2+1/3+1/4+... +1/n  int n = 0;  
  cin >> n;  cout << getSum(n) << endl;  */}
```

# C语言的整数溢出问题

![](image/Pasted%20image%2020220916012225.png)

```cpp
#include <iostream>  
using namespace std;  
  
#include <boost/multiprecision/cpp_int.hpp>  
using namespace boost::multiprecision;  
  
int main()  
{  
   // 例子1  
   //int i = 2147483640;   
   //for (; i > 0; i++)   
   //{   
	   // cout << "adding " << i << endl;   
   //}   
   //cout << "exit " << i << endl;  

   // boost version   
   //cpp_int i2 = 2147483640;   
   //for (; i2 > 0; i2++)   
   //{   
	   // cout << "adding " << i2 << endl;   
   //}   
   //cout << "exit " << i2 << endl;      
   
   // 例子2  
   int a = 500;  
   int b = 400;  
   int c = 300;  
   int d = 200;  
   cout << a * b * c * d << endl;  
  
   // boost version  
   cpp_int ba = 500;  
   int bb = 400;  
   int bc = 300;  
   int bd = 200;  
   cout << ba * bb * bc * bd << endl;  
}
```

# C语言字符串的典型缺陷

![](image/Pasted%20image%2020220916013613.png)

![](image/Pasted%20image%2020220916013722.png)

```cpp
#include <iostream>  
#include <string>  
using namespace std;  
  
static const int MAX_LEN = 30;  
int main() {  
  char str1[] = "string";  
  cout << strlen(str1) << endl;  
  cout << sizeof(str1) / sizeof(str1[0]) << endl;  
  
  char str2[] = "stri\0ng";  
  cout << strlen(str2) << endl;  
  cout << sizeof(str2) / sizeof(str2[0]) << endl;  
  
  char str1A[MAX_LEN] = "stringA";  
  strcat(str1A, str2);  
  cout << str1A << endl;  
  cout << strlen(str1A) << endl;  
  cout << sizeof(str1A) / sizeof(str1A[0]) << endl;  
  
  cout << endl;  
  cout << "Testing C++ String: " << endl;  
  string sstr1 = "string";  
  cout << sstr1.length() << endl;  
  cout << sstr1.capacity() << endl;  
  cout << sizeof(sstr1) << endl;  
  
  cout << "sstr2: " << endl;  
  string sstr2 = "stri\0ng";  
  cout << sstr2.length() << endl;  
  cout << sstr2.capacity() << endl;  
  cout << sizeof(sstr2) << endl;  
  
  cout << "sstr1: " << endl;  
  sstr1 += sstr2;  
  cout << sstr1.length() << endl;  
  cout << sstr1.capacity() << endl;  
  cout << sizeof(sstr1) << endl;  
}
```