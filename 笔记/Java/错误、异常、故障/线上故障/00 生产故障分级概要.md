# 开篇

- 计算机是当今世界的命脉，你能看到的任何地方，计算机都在改变着世界，不论是传统的制造生产，医疗通讯。还是新兴的虚拟现实无人驾驶汽车等领域。过去的儿十年，计算机硬件 飞速发展，软件领域也是不断刷新看人们的想象。可以说，计算机学科复杂而且庞大，甚至有人说，不亚于物理学。

- 今天我们讨论的话题，线上事故分析，只是其中的一部分，一小部分，为了说清楚这一点，我们简单了解一下软件工程学科。玛格丽特·希菲尔德·汉密尔顿 （英语： Margaret Heafield Hamilton， 1936年8月17日 ） 被认为发明了软件工程一词。

- 她帮助了NASA在阿波罗计划中避免了严重问题。她曾这样说：“有点像牙根管治疗：你总是拖到最后才做，但有些事可以预先做好，有点像预防性体验，只不过是预防软件出错”。

- 我们不妨简单总结如何开发一个大型的软件项目下：
1. 基于面向对象的编程语言
2. 容易使用的集成开发环境
3. 文档和注释 （程序员最讨厌的两件事，写注释给别人读，阅读别人没有写注释的代码
4. 构建管理和版本控制
5. 质量保证测试（QUALITY ASSURANCE-QA）

- 每个软件从业者从写下第一行代码开始，就一刻不停地和软件中的错误做斗争。
- 开发和维护（修复缺陷、确保资源充足等保障软件运行的活动）是伴随软件运行而产生的。
- 从零到一开发软件是开发者的天性，看到自已编写的软件完美运行，为其他开发者提供服务，一直是驱动开发者前进的动力。
- 为了更快更好地开发软件，我们不断改进开发方法和软件架构，但是开发者在使用新的方法和更复杂的架构时，往往也会低估潜在的风险。

# 事故等级定义

- 业务和产品的线上质量、是研发团队的生命线，也是支撑业务快速试错，小步跑的前置条件。 
- Bug != 故障

## 故障等级定义

- 故障等级定义，不同的业务形态，不同的公司团队，有不一样的划分标准，下表列举了一般常见的维度和标准

|    线上故障等级     | 标准                                                                                                                                                                                                                                      | 是否回滚 |
| :-----------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--: |
| 【P0】 致命<br>问题 | **安全**：影响线上生产[核心数据](#核心数据定义)安全（丢失、泄漏）<br />**功能**：造成系统崩溃、死机，主要功能或重要功能完全不能正常使用<br />**资损**：造成资损 > 5W<br/>**体验**： <br />（1）有效客诉 > 30人或客诉 > 50人； <br />（2）由于系统问题导致、不能开展业务的核心企业，超过 3 家<br/>**影响范围**：针对[系统](#系统级别定义)的[影响范围与故障等级](#影响范围与故障等级) |  是   |
| 【P1】 严重<br>问题 | **安全**：影响线上生产部分数据安全 （丢失、泄露）<br />**功能**：主要功能部分丧失或次要功能大部分丧失，或严重误导的提示信息<br />**资损**：造成资损 > 1W<br/>**体验**：<br />（1）有效客诉 > 5人<br />（2）由于系统问题导致、不能正常开展业务的核心企业，超过 1 家 <br />**影响范围**：针对[系统](#系统级别定义)的[影响范围与故障等级](#影响范围与故障等级)                  |  是   |
|   【P2】 一般问题   | **功能**：次要功能丧失、边界校验不全等；<br />**体验**：用户界面交互差或操作等待时间长；<br/>**资损**：造成资损 > 1K<br/>**影响范围**：针对[系统](#系统级别定义)的[影响范围与故障等级](#影响范围与故障等级)                                                                                                           |  否   |
|   【P3】 轻微问题   | **功能**：界面提示描述错别字、排版问题等用户提示性问题，但不影响执行工作功能或重要功能                                                                                                                                                                                           |  否   |
|  **线上故障分类**   | **说明**                                                                                                                                                                                                                                  |      |
|     外部依赖类     | 是由所依赖的上下游系统的缺陷或不稳定直接导致业务流程受阻，用户体验客诉类事故                                                                                                                                                                                                  |      |
|     运营质量类     | 由运营或业务人员在进行营销活[[]]动创建或线上策略配置错误等导致的一些问题                                                                                                                                                                                                  |      |
|     需求质量类     | 由于产品方案设计存在逻辑或流程上缺陷直接导致的线上问题                                                                                                                                                                                                             |      |
|     系统质量类     | 系统存在逻辑或流程缺陷直接导致线上问题，同时还包括性能、稳定性引发的问题                                                                                                                                                                                                    |      |

## 核心数据定义

### 个人敏感信息

- 姓名
- 出生日期
- 身份证件号码
- 个人生物识别信息
- 住址
- 通信通讯联系方式
- 通信记录和内容
- 账号密码
- 财产信息
- 征信信息
- 行踪轨迹
- 住宿信息
- 健康生理信息
- 交易信息等

### 用户画像

- 职业
- 经济
- 健康
- 教育
- 个人喜好
- 信用
- 行为等

## 系统级别定义

- 零级系统（P0)：为公司核心业务服务的核心系统，一旦发生不可用会直接影响公司核心业务的业务连续性，对所有系统用户造成影响。
- 一级系统（P1）：重点的业务系统，一旦发生不可用，影响核心业务的连续性，并造成大部分内部用户或外部用户不可使用此系统
- 二级系统（P2）：重要的业务系统，一旦发生不可用存在一定的业务可用性问题，但不会影响核心业务的业务连续性。
- 三级系统（P3）：非核心的支撑系统，一旦发生故障不直接产生业务影响，但会影响少部分内部用户使用此系统。

## 影响范围与故障等级

|   系统分级    | 故障时长\受影响用户 | 全部用户 | 大部分用户（超过20%） | 少量用户 |
|:-------------:|:-------------------:|:--------:|:---------------------:|:--------:|
| 0 级系统 (P0) |     超过60分钟      |    P0    |          P0           |    P1    |
|               |     超过30分钟      |    P1    |          P2           |          |
|               |     超过10分钟      |    P1    |          P2           |          |
|               |     10分钟以内      |    P2    |          P2           |          |
| 一级系统 (P1) |     超过60分钟      |    P0    |          P1           |    P1    |
|               |     超过30分钟      |    P1    |          P2           |          |
|               |     超过10分钟      |    P1    |          P2           |          |
|               |     10分钟以内      |    P2    |          N/A          |          |
| 二级系统 (P2) |     超过60分钟      |    P1    |          P1           |    P2    |
|               |     超过30分钟      |    P2    |          P2           |          |
|               |     超过10分钟      |    P2    |          P2           |          |
|               |     10分钟以内      |   N/A    |          N/A          |          |
| 三级系统 (P3) |     超过60分钟      |    P1    |          P2           |    P2    |
|               |     超过30分钟      |    P2    |          N/A          |          |
|               |     超过10分钟      |   N/A    |          N/A          |          |
|               |     10分钟以内      |   N/A    |          N/A          |          |

# 故障报告模板示例

- 参考

|    故障分析报告    |                |                                                                                                                                                                 |        |
| :----------: | :------------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----: |
|     故障编号     |                | 服务不可用时间                                                                                                                                                         |        |
|    故障开始时间    |                | 故障结束时间                                                                                                                                                          |        |
|     故障类型     |                | 责任组（造成该故障的主要责任组）                                                                                                                                                |        |
|  **一、问题回顾**  |                |                                                                                                                                                                 |        |
|     故障情况     |      概要描述      | 对事故进行概要描述，**写清楚**<br/>何时？<br/>何系统？<br/>因何原因？<br/>发生什么故障。<br/>总体现象是什么（影响用户，服务拒绝还是功能错误？）                                                                          |        |
|              |      问题经过      | 补充故障的完整时间线，方便回溯内容，以时间顺序详细描述故障<br/>发生（诱发）<br/>发展（扩散、隔离）<br/>发现（测试、监控、内部反馈、用户反馈和客服）<br/>处理（止损）过程及其间系统的表现<br/>重点关注诱发原因，扩散条件，止损动作，止损效果等关键要素<br/>每句以时间开头，每个关键节点独写一行。 |        |
|              |      问题原因      | 描述故障根本原因，以及此原因导致故障发生的逻辑。                                                                                                                                        |        |
|              |    故障影响和损失     | 详细描述故障对业务的影响以及具体的损失数据，格式：<br/>1、故障影响范围及程度说明<br/>2、损失具体情况<br/>损失数据包括：流量损失、收入损失、流失损失，损失占当天的比例                                                                     |        |
| **二、后续改进措施** |                |                                                                                                                                                                 |        |
|      序号      | 管理措施+技术措施+产品功能 | 负责人                                                                                                                                                             | 期望完成时间 |
|      1       |                |                                                                                                                                                                 |        |
|      2       |                |                                                                                                                                                                 |        |
|      3       |                |                                                                                                                                                                 |        |

# 故障响应处理机制

![](image/Pasted%20image%2020250104023126.png)

- 如图所示，大体描述了一般生产故障的处理机制故障发现
1. 客户投诉或者业务反馈，研发自我发现
2. 监控报警：技术监控，业务监控

# 思考

- 为什么会发生这个问题？
- 为什么测试阶段没有发现？
- 为什么系统不能容错？
- 能不能更早发现问题？
- 解决过程能不能更快？
- 怎样防止类似的事情发现？
