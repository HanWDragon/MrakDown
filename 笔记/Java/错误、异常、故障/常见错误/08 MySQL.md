# 表属性设置为 NULL

![](image/Pasted%20image%2020241213000659.png)

## MySQL 对 NULL 的描述

![](image/Pasted%20image%2020241213000807.png)
## 存在的问题

![](image/Pasted%20image%2020241213000848.png)

- NULL 在 MySQL 是有特殊标记

![](image/Pasted%20image%2020241213000945.png)

- Null参与的查询不能使用 = < > 这样什么数据都拿不到，必须使用 is or is not
	- 当对可以为 NULL 的列进行条件查询，最后会隐式的添加 is not null
- 对 NULL 列也会加上索引，但只有 is 做判断才会使用索引，MySQL很难对查询做优化
	- NULL 对唯一性索引不生效
- NULL 参与任何计算都是 NULL
- 存在 NULL 的列参与聚合，结果是不包含 NULL 的列
- 存在 NULL 的列参与排序，asc NULL 在最前面 desc 在最后面

## 如何代替NULL

![](image/Pasted%20image%2020241213002337.png)

# 随意设置数据类型

## 选择数据类型，先从主键开始

![](image/Pasted%20image%2020241213002824.png)
## 选择合适的数据类型和取值范围

![](image/Pasted%20image%2020241213003004.png)

- 字符串
	- char 占固定长度
	- varchar 用多少占多少
	- 字符长度超过 500 就要使用 text 类型，这个类型没有默认值，索引也只能针对前多少字符
- 日期、时间
	- date 日期
	- time 时间
	- datetime 日期和时间的组合
	- timestamp 和 datetime 类型

| 数据类型         | 取值范围/最大长度                                                                   | 使用建议             |
| ------------ | --------------------------------------------------------------------------- | ---------------- |
| **字符串**      |                                                                             |                  |
| `char`       | 最大长度 255 字符                                                                 | 定长字符串，适合存储定长数据   |
| `varchar`    | 最大长度 65535 字节                                                               | 变长字符串，适合存储可变长度数据 |
| `tinytext`   | 最大长度 255 字节                                                                 | 小文本数据            |
| `text`       | 最大长度 65535 字节                                                               | 中等大小文本数据         |
| `mediumtext` | 最大长度 16777215 字节                                                            | 较大文本数据           |
| `longtext`   | 最大长度 4294967295 字节                                                          | 超大文本数据           |
| **日期/时间**    |                                                                             |                  |
| `date`       | 1000-01-01 到 9999-12-31                                                     | 日期值              |
| `time`       | '-838:59:59' 到 '838:59:59'                                                  | 时间值              |
| `datetime`   | 1000-01-01 00:00:00 到 9999-12-31 23:59:59                                   | 日期和时间值           |
| `timestamp`  | 1970-01-01 00:00:01 UTC 到 2038-01-19 03:14:07 UTC                           | 自动存储记录修改时间       |
| **数值**       |                                                                             |                  |
| `tinyint`    | -128 到 127 或 0 到 255 (无符号)                                                  | 小整数值             |
| `int`        | -2147483648 到 2147483647 或 0 到 4294967295 (无符号)                             | 整数值              |
| `bigint`     | -9223372036854775808 到 9223372036854775807 或 0 到 18446744073709551615 (无符号) | 大整数值             |
| `float`      | 约 -3.402823466E+38 到 3.402823466E+38                                        | 单精度浮点数，适合存储小数    |
| `double`     | 约 -1.7976931348623157E+308 到 1.7976931348623157E+308                        | 双精度浮点数，适合存储精确小数  |
| `decimal`    | 依赖于定义，最大 65 位数字                                                             | 精确小数值，适合存储高精度小数  |
| **二进制**      |                                                                             |                  |
| `tinyblob`   | 最大长度 255 字节                                                                 | 小型二进制数据          |
| `blob`       | 最大长度 65535 字节                                                               | 中等大小二进制数据        |
| `mediumblob` | 最大长度 16777215 字节                                                            | 较大二进制数据          |
| `longblob`   | 最大长度 4294967295 字节                                                          | 超大二进制数据          |

## 不要使用枚举 ENUM

![](image/Pasted%20image%2020241213004037.png)

### 特性、注意事项

![](image/Pasted%20image%2020241213004408.png)

- 第三条很容易出问题，1 和 '1' 在插入的时候会有不同的解释，数字会当成索引，而字符串会被解析成数字当成索引

## 技巧和建议

![](image/Pasted%20image%2020241213005126.png)

# 索引问题

## 索引加对了，但是没用到

![](image/Pasted%20image%2020241213005352.png)

## 索引加错、冗余

![](image/Pasted%20image%2020241213010249.png)
## 建议

![](image/Pasted%20image%2020241213011151.png)

# 莫名其妙断连

![](image/Pasted%20image%2020241213011336.png)

![](image/Pasted%20image%2020241213011352.png)

## autoReconnect 副作用

![](image/Pasted%20image%2020241213011502.png)
## 修改配置来解决

![](image/Pasted%20image%2020241213011629.png)

## 连接池配置

![](image/Pasted%20image%2020241213012244.png)

# 事务出错，锁可能用的不对

## 数据库锁的分类

![](image/Pasted%20image%2020241213012627.png)

## 小心行锁升级

![](image/Pasted%20image%2020241213013746.png)

# 优化慢 SQL

## 如何配置 MySQL 定位慢查询

![](image/Pasted%20image%2020241213014752.png)

## 使用 mysqldumpslow 解读慢日志

![](image/Pasted%20image%2020241213015149.png)

## 使用 explain/desc 分析慢 SQL

![](image/Pasted%20image%2020241213015513.png)

## 总结

![](image/Pasted%20image%2020241213015740.png)

# 分库分表

## 业务发展带来的问题

![](image/Pasted%20image%2020241213020135.png)
## 分库分表的策略

## 垂直切分

![](image/Pasted%20image%2020241213020241.png)

### 优点

![](image/Pasted%20image%2020241213021418.png)

### 代价

![](image/Pasted%20image%2020241213021426.png)

## 水平切分

![](image/Pasted%20image%2020241213021552.png)

## 带来的问题

![](image/Pasted%20image%2020241213021743.png)
## 如何实现

![](image/Pasted%20image%2020241213022532.png)