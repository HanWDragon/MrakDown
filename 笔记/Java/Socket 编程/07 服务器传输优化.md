# 阻塞 IO 和非阻塞 IO

- 之前发送还是接收都是通过开多线程来解决调用方法阻塞的问题，因为服务端需要不停的轮询来获取客户端的连接，这也是 BIO 的缺陷

![](image/Pasted%20image%2020250103200615.png)

# 阻塞 IO 

![](image/Pasted%20image%2020241222153617.png)

![](image/Pasted%20image%2020250103200636.png)

## 处理多客户连接

![](image/Pasted%20image%2020250103200751.png)

# 非阻塞 IO

 ![](image/Pasted%20image%2020241222154322.png)

![](image/Pasted%20image%2020250103200710.png)

![](image/Pasted%20image%2020241222155102.png)

## 处理多客户连接

![](image/Pasted%20image%2020250103200818.png)

# NIO Family 一览

![](image/Pasted%20image%2020241222155646.png)

![](image/Pasted%20image%2020241222155807.png)

## Buffer

![](image/Pasted%20image%2020241222155915.png)

![](image/Pasted%20image%2020241222160034.png)

![](image/Pasted%20image%2020241226191008.png)

![](image/Pasted%20image%2020241226191202.png)

![](image/Pasted%20image%2020241226191226.png)

![](image/Pasted%20image%2020241226191301.png)

![](image/Pasted%20image%2020241226191312.png)

## Channel

- 对于 Channel 读是独占的，写是独占的，读和写之间是异步的，可以两个线程操作
- eg：当传输大文件时，这个 Channel 的写入就是独占的

![](image/Pasted%20image%2020241222160539.png)

![](image/Pasted%20image%2020241222160638.png)

# NIO 常见 API

## NIO 职责

![](image/Pasted%20image%2020241222165201.png)

## Selector

### 注册事件
 ![](image/Pasted%20image%2020241222161145.png)
### 使用流程

![](image/Pasted%20image%2020241222161732.png)

![](image/Pasted%20image%2020241222162015.png)

### 注意事项

![](image/Pasted%20image%2020241222162144.png)

### SelectionKeys

![](image/Pasted%20image%2020241222162342.png)

 # NIO 重写服务器

## 重写哪些功能

- 需要修改 TCP Server 和 TCP Handler
	- 原先是开线程来进行 accept，现在在 start() 注册 Selecror
	- 原先是 ServerSocket 现在使用 ServerSocketChannel
	- 配置成非阻塞

![](image/Pasted%20image%2020241223105604.png)

## 线程优化

### 现有线程模型

![](image/Pasted%20image%2020241226191735.png)

### 单 Thread 模型

![](image/Pasted%20image%2020241226191850.png)
### 监听与数据处理分离

![](image/Pasted%20image%2020241226192153.png)

## 代码实现

