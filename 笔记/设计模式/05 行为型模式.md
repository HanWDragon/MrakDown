# 模板方法模式

## 定义

![](image/Pasted%20image%2020241229200942.png)

## 适用场景

![](image/Pasted%20image%2020241229201050.png)

## 优点

![](image/Pasted%20image%2020241229201129.png)

## 缺点

![](image/Pasted%20image%2020241229201140.png)
## 扩展

![](image/Pasted%20image%2020241229201217.png)

## 相关设计模式

![](image/Pasted%20image%2020241229201241.png)

## 代码

![](image/Pasted%20image%2020241230110359.png)

```java
public abstract class ACourse {

    protected final void makeCourse(){
        this.makePPT();
        this.makeVideo();
        if(needWriteArticle()){
            this.writeArticle();
        }
        this.packageCourse();
    }

    final void makePPT(){
        System.out.println("制作PPT");
    }
    final void makeVideo(){
        System.out.println("制作视频");
    }
    final void writeArticle(){
        System.out.println("编写手记");
    }
    //钩子方法
    protected boolean needWriteArticle(){
        return false;
    }
    abstract void packageCourse();
}


public class DesignPatternCourse extends ACourse {
    @Override
    void packageCourse() {
        System.out.println("提供课程Java源代码");
    }

    @Override
    protected boolean needWriteArticle() {
        return true;
    }

}

public class FECourse extends ACourse {
    private boolean needWriteArticleFlag = false;
    @Override
    void packageCourse() {
        System.out.println("提供课程的前端代码");
        System.out.println("提供课程的图片等多媒体素材");
    }

    public FECourse(boolean needWriteArticleFlag) {
        this.needWriteArticleFlag = needWriteArticleFlag;
    }

    @Override
    protected boolean needWriteArticle() {
        return this.needWriteArticleFlag;
    }
}

public class Test {
    public static void main(String[] args) {
//        System.out.println("后端设计模式课程start---");
//        ACourse designPatternCourse = new DesignPatternCourse();
//        designPatternCourse.makeCourse();
//        System.out.println("后端设计模式课程end---");


        System.out.println("前端课程start---");
        ACourse feCourse = new FECourse(false);
        feCourse.makeCourse();
        System.out.println("前端课程end---");


    }
}
```

## 源码

- abstractList abstractSet abstractMap抽象类
- HttpServlet doGet doPost service 之类的方法
- Mybatis 的 BaseExecutor

![](image/Pasted%20image%2020241231185803.png)

# 迭代器模式

## 定义

![](image/Pasted%20image%2020241231185947.png)

## 适用场景

![](image/Pasted%20image%2020241231190149.png)

## 优点

![](image/Pasted%20image%2020241231190209.png)

## 缺点

![](image/Pasted%20image%2020241231190358.png)

## 相关设计模式

- 迭代器和访问者都是访问一个元素，访问者在对象的操作上，迭代器在种类上，实现方式有区别

```java
public interface CourseAggregate {

    void addCourse(Course course);
    void removeCourse(Course course);

    CourseIterator getCourseIterator();

}

public interface CourseIterator {
    Course nextCourse();
    boolean isLastCourse();

}

public class CourseAggregateImpl implements CourseAggregate {

    private List courseList;

    public CourseAggregateImpl() {
        this.courseList = new ArrayList();
    }

    @Override
    public void addCourse(Course course) {
        courseList.add(course);
    }

    @Override
    public void removeCourse(Course course) {
        courseList.remove(course);
    }

    @Override
    public CourseIterator getCourseIterator() {
        return new CourseIteratorImpl(courseList);
    }
}

public class CourseIteratorImpl implements CourseIterator {

    private List courseList;
    private int position;
    private Course course;
    public CourseIteratorImpl(List courseList){
        this.courseList=courseList;
    }

    @Override
    public Course nextCourse() {
        System.out.println("返回课程,位置是: "+position);
        course=(Course)courseList.get(position);
        position++;
        return course;
    }

    @Override
    public boolean isLastCourse(){
        if(position< courseList.size()){
            return false;
        }
        return true;
    }
}


public class Course {
    private String name;

    public Course(String name) {
        this.name = name;
    }

    public String getName() {
        return name;
    }

}

public class Test {


    public static void main(String[] args) {
        Course course1 = new Course("Java电商一期");
        Course course2 = new Course("Java电商二期");
        Course course3 = new Course("Java设计模式精讲");
        Course course4 = new Course("Python课程");
        Course course5 = new Course("算法课程");
        Course course6 = new Course("前端课程");


        CourseAggregate courseAggregate = new CourseAggregateImpl();

        courseAggregate.addCourse(course1);
        courseAggregate.addCourse(course2);
        courseAggregate.addCourse(course3);
        courseAggregate.addCourse(course4);
        courseAggregate.addCourse(course5);
        courseAggregate.addCourse(course6);

        System.out.println("-----课程列表-----");
        printCourses(courseAggregate);

        courseAggregate.removeCourse(course4);
        courseAggregate.removeCourse(course5);

        System.out.println("-----删除操作之后的课程列表-----");
        printCourses(courseAggregate);
    }


    public static void printCourses(CourseAggregate courseAggregate){
        CourseIterator courseIterator= courseAggregate.getCourseIterator();
        while(!courseIterator.isLastCourse()){
            Course course=courseIterator.nextCourse();
            System.out.println(course.getName());
        }
    }


}

```

![](image/Pasted%20image%2020241231191516.png)

## 源码

- Itr in ArrayList
- 看 Iterator 实现的实现类

# 策略模式

## 定义

![](image/Pasted%20image%2020241231192541.png)

## 适用场景

![](image/Pasted%20image%2020241231192608.png)

## 优点

![](image/Pasted%20image%2020241231192632.png)

## 缺点

![](image/Pasted%20image%2020241231192721.png)

## 相关设计模式

![](image/Pasted%20image%2020241231192739.png)

## 代码

![](image/Pasted%20image%2020241231223400.png)

## 初级应用

```java
public interface PromotionStrategy {
    void doPromotion();
}

public class ManJianPromotionStrategy implements PromotionStrategy{
    @Override
    public void doPromotion() {
        System.out.println("满减促销,满200-20元");
    }
}

public class LiJianPromotionStrategy implements PromotionStrategy {
    @Override
    public void doPromotion() {
        System.out.println("立减促销,课程的价格直接减去配置的价格");
    }
}

public class FanXianPromotionStrategy implements PromotionStrategy{
    @Override
    public void doPromotion() {
        System.out.println("返现促销,返回的金额存放到慕课网用户的余额中");
    }
}


public class PromotionActivity {
    private PromotionStrategy promotionStrategy;

    public PromotionActivity(PromotionStrategy promotionStrategy) {
        this.promotionStrategy = promotionStrategy;
    }

    public void executePromotionStrategy(){
        promotionStrategy.doPromotion();
    }

}

public class Test {
    public static void main(String[] args) {
        PromotionActivity promotionActivity618 = new PromotionActivity(new LiJianPromotionStrategy());
        PromotionActivity promotionActivity1111 = new PromotionActivity(new FanXianPromotionStrategy());

        promotionActivity618.executePromotionStrategy();
        promotionActivity1111.executePromotionStrategy();
    }
}
```

## 高级应用

```java
public interface PromotionStrategy {  
    void doPromotion();  
}

public class EmptyPromotionStrategy implements  PromotionStrategy{  
  
    @Override  
    public void doPromotion() {  
        System.out.println("无促销");  
    }  
}

public class FanXianPromotionStrategy implements PromotionStrategy{  
    @Override  
    public void doPromotion() {  
        System.out.println("返现促销,返回的金额存放到慕课网用户的余额中");  
    }  
}

public class LiJianPromotionStrategy implements PromotionStrategy {  
    @Override  
    public void doPromotion() {  
        System.out.println("立减促销,课程的价格直接减去配置的价格");  
    }  
}

public class ManJianPromotionStrategy implements PromotionStrategy{  
    @Override  
    public void doPromotion() {  
        System.out.println("满减促销,满200-20元");  
    }  
}

public class PromotionActivity {  
    private PromotionStrategy promotionStrategy;  
  
    public PromotionActivity(PromotionStrategy promotionStrategy) {  
        this.promotionStrategy = promotionStrategy;  
    }  
  
    public void executePromotionStrategy(){  
        promotionStrategy.doPromotion();  
    }  
  
}

public class PromotionStrategyFactory {  
    private  static final Map<String,PromotionStrategy> PROMOTION_STRATEGY_MAP = new HashMap<>();  
  
    public static final PromotionStrategy NON_PROMOTION_STRATEGY = new EmptyPromotionStrategy();  
  
    static {  
        PROMOTION_STRATEGY_MAP.put(PromotionStrategyKey.LI_JIAN,new LiJianPromotionStrategy());  
        PROMOTION_STRATEGY_MAP.put(PromotionStrategyKey.MAN_JIAN,new ManJianPromotionStrategy());  
        PROMOTION_STRATEGY_MAP.put(PromotionStrategyKey.FAN_XIAN,new FanXianPromotionStrategy());  
    }  
  
    public PromotionStrategyFactory() {  
    }  
  
    public static PromotionStrategy getPromotionStrategy(String key){  
        PromotionStrategy strategy = PROMOTION_STRATEGY_MAP.get(key);  
        return  strategy == null ?  NON_PROMOTION_STRATEGY : strategy;  
    }  
  
    public interface PromotionStrategyKey {  
        String LI_JIAN = "LI_JIAN";  
        String MAN_JIAN = "MAN_JIAN";  
        String FAN_XIAN = "FAN_XIAN";  
    }  
}

public class Test {

//    public static void main(String[] args) {  
//        PromotionActivity promotionActivity618 = new PromotionActivity(new LiJianPromotionStrategy());  
//        PromotionActivity promotionActivity1111 = new PromotionActivity(new FanXianPromotionStrategy());  
//  
//        promotionActivity618.executePromotionStrategy();  
//        promotionActivity1111.executePromotionStrategy();  
//    }  
  
    public static void main(String[] args) {  
        PromotionActivity promotionActivity = null;  
        String promotionKey = "LI_JIAN";  
        promotionActivity = new PromotionActivity(PromotionStrategyFactory.getPromotionStrategy(promotionKey));  
        promotionActivity.executePromotionStrategy();  
  
    }  
}
```

## 源码

- `Comparator`接口就是策略模式的一个典型例子。我们可以定义不同的比较策略（例如按年龄、按姓名排序），并在排序时将其传递给排序算法（如`Collections.sort`）
- 在JCA中，`Signature`类中使用了策略模式，允许开发者选择不同的签名算法（如SHA256withRSA, SHA1withDSA等）
- MyBatis中有多个`Executor`实现（如`SimpleExecutor`、`ReuseExecutor`、`BatchExecutor`），可以根据需要选择不同的执行策略。

# 解释器模式

## 定义

![](image/Pasted%20image%2020250101152354.png)

## 适用场景

![](image/Pasted%20image%2020250101152504.png)

## 优点

![](image/Pasted%20image%2020250101152702.png)

## 缺点

![](image/Pasted%20image%2020250101152722.png)

## 相关技术模式

![](image/Pasted%20image%2020250101152828.png)

## 代码

![](image/Pasted%20image%2020250101202533.png)

```java
public interface Interpreter {  
    int interpret ();  
}

public class AddInterpreter implements  Interpreter{  
  
    private final Interpreter firstExpression;  
    private final Interpreter secondExpression;  
  
    public AddInterpreter(Interpreter firstExpression, Interpreter secondExpression) {  
        this.firstExpression = firstExpression;  
        this.secondExpression = secondExpression;  
    }  
  
    @Override  
    public int interpret() {  
        return firstExpression.interpret() + secondExpression.interpret();  
    }  
  
    @Override  
    public String toString() {  
        return "+";  
    }  
}

public class MultiInterpreter implements  Interpreter{  
  
    private final Interpreter firstExpression;  
    private final Interpreter secondExpression;  
  
    public MultiInterpreter(Interpreter firstExpression, Interpreter secondExpression) {  
        this.firstExpression = firstExpression;  
        this.secondExpression = secondExpression;  
    }  
  
    @Override  
    public int interpret() {  
        return firstExpression.interpret() * secondExpression.interpret();  
    }  
  
    @Override  
    public String toString() {  
        return "*";  
    }  
}

public class NumberInterpreter implements  Interpreter{  
  
    private final int num;  
  
  
    public NumberInterpreter(int num) {  
        this.num = num;  
    }  
  
    public NumberInterpreter(String num) {  
        this.num = Integer.parseInt(num);  
    }  
  
    @Override  
    public int interpret() {  
        return this.num;  
    }  
  
}

public class CustomerExpressionParser {  
  
    private final Stack<Interpreter> stack = new Stack<>();  
  
    public int parse(String str) {  
        String[] strItemArray = str.split(" ");  
        for (String symbol : strItemArray) {  
            if (!OperatorUtil.isOperator(symbol)) {  
                Interpreter numberExpression = new NumberInterpreter(symbol);  
                stack.push(numberExpression);  
                System.out.format("入栈：%d \n", numberExpression.interpret());  
            } else {  
                Interpreter firstExpression = stack.pop();  
                Interpreter secondExpression = stack.pop();  
                System.out.format("出栈：%d 和 %d \n", firstExpression.interpret(), secondExpression.interpret());  
                Interpreter operator = OperatorUtil.getExpressionObject(firstExpression, secondExpression, symbol);  
                System.out.printf("应用运算符：%s \n",operator);  
                int result = operator.interpret();  
                NumberInterpreter resultExpression = new NumberInterpreter(result);  
                stack.push(resultExpression);  
                System.out.printf("阶段结果入栈：%d \n",resultExpression.interpret());  
  
            }  
        }  
        return stack.pop().interpret();  
    }  
      
}

public class OperatorUtil {  
    public static boolean isOperator(String symbol) {  
        return (symbol.equals("+") ||symbol.equals("*"));  
    }  
  
    public static Interpreter getExpressionObject(Interpreter first , Interpreter second ,String symbol) {  
        if (symbol.equals("+")) {  
            return new AddInterpreter(first, second);  
        } else if (symbol.equals("*")) {  
            return  new MultiInterpreter(first,second);  
        }  
        return null;  
    }  
}

public class Test {  
    public static void main(String[] args) {  
        String inputStr = "6 100 11 + *";  
        CustomerExpressionParser expressionParser = new CustomerExpressionParser();  
        int result = expressionParser.parse(inputStr);  
        System.out.println("解释器计算结构：" + result);  
    }  
}
```

## 源码

- Pattern
- Spring el 表达式

# 观察者模式

## 定义

![](image/Pasted%20image%2020250101205956.png)

## 适用场景

![](image/Pasted%20image%2020250101210023.png)

## 优点

![](image/Pasted%20image%2020250101210036.png)

## 缺点

![](image/Pasted%20image%2020250101210119.png)

## 代码

![](image/Pasted%20image%2020250101210723.png)

```java
public class Course extends Observable {  
  
    private String courseName;  
  
    public Course(String courseName) {  
        this.courseName = courseName;  
    }  
  
    public String getCourseName() {  
        return courseName;  
    }  
  
    public void setCourseName(String courseName) {  
        this.courseName = courseName;  
    }  
  
    public void produceCourse(Course course, Question question) {  
        System.out.println(question.getUserName() + "在" + course.courseName + "提交了一个问题");  
        setChanged();  
        notifyObservers(question);  
    }  
}

public class Question {  
  
    private String userName;  
    private String questionContent;  
  
    public String getUserName() {  
        return userName;  
    }  
  
    public void setUserName(String userName) {  
        this.userName = userName;  
    }  
  
    public String getQuestionContent() {  
        return questionContent;  
    }  
  
    public void setQuestionContent(String questionContent) {  
        this.questionContent = questionContent;  
    }  
}

public class Teacher implements Observer {  
    private final String teacherName;  
  
    public Teacher(String teacherName) {  
        this.teacherName = teacherName;  
    }  
  
    @Override  
    public void update(Observable o, Object arg) {  
        Course course = (Course) o;  
        Question question = (Question) arg;  
        System.out.println(teacherName + "老师的" + course.getCourseName() + "课程接收到一个" + question.getUserName() + "提交的问答:" + question.getQuestionContent());  
    }  
}

public class Test {  
    public static void main(String[] args) {  
        Course course = new Course("设计模式");  
        Teacher teacher = new Teacher("Han");  
  
        course.addObserver(teacher);  
  
        Question question = new Question();  
        question.setUserName("Xiao");  
        question.setQuestionContent("Test");  
        course.produceCourse(course,question);  
  
    }  
}

```

- 这个 API 在 9 被废弃了，以下是两种新方法
1. 使用 `PropertyChangeSupport` 和 `PropertyChangeListener` `PropertyChangeSupport` 是 Java 标准类，特别适合处理简单的属性变更通知。
2. 使用 `java.util.concurrent.Flow` API

1. `PropertyChangeSupport` 和 `PropertyChangeListener`：
    - 易于理解和使用。
    - 更适用于简单的属性变更需求。
    - 线程安全，适合单一事件的监听。
2. `java.util.concurrent.Flow` API：  
    - 更强大的发布-订阅模型。
    - 支持异步非阻塞设计，适合处理高吞吐场景。
    - 更灵活复杂的场景中建议使用。

```java
import java.beans.PropertyChangeListener;
import java.beans.PropertyChangeSupport;

// 被观察者类
class ObservableModel {
    private String property; // 我们观察的属性
    private final PropertyChangeSupport support; // 管理观察者的支持类

    public ObservableModel() {
        support = new PropertyChangeSupport(this); // 初始化支持类
    }

    // 添加观察者
    public void addPropertyChangeListener(PropertyChangeListener listener) {
        support.addPropertyChangeListener(listener);
    }

    // 移除观察者
    public void removePropertyChangeListener(PropertyChangeListener listener) {
        support.removePropertyChangeListener(listener);
    }

    // 属性的setter方法，通知监听者属性值的变更
    public void setProperty(String newValue) {
        String oldValue = this.property; // 取旧值用于对比
        this.property = newValue;

        // 通知观察者，传递旧值、新值和属性名
        support.firePropertyChange("property", oldValue, newValue);
    }

    // 属性的getter方法
    public String getProperty() {
        return property;
    }
}

// 观察者类
class Observer implements PropertyChangeListener {
    private final String name; // 观察者名称，方便区分

    public Observer(String name) {
        this.name = name;
    }

    @Override
    public void propertyChange(java.beans.PropertyChangeEvent evt) {
        // 接收通知并处理
        System.out.println(name + " 观察到属性 " + evt.getPropertyName() + " 改变： " +
                "旧值 = " + evt.getOldValue() + ", 新值 = " + evt.getNewValue());
    }
}

public class Main {
    public static void main(String[] args) {
        ObservableModel model = new ObservableModel(); // 创建被观察者
        Observer observer1 = new Observer("观察者1"); // 创建观察者1
        Observer observer2 = new Observer("观察者2"); // 创建观察者2

        // 注册观察者
        model.addPropertyChangeListener(observer1);
        model.addPropertyChangeListener(observer2);

        // 改变属性值，触发通知
        model.setProperty("初始值");
        model.setProperty("新值");
    }
}

```

```java
import java.util.concurrent.SubmissionPublisher;
import java.util.concurrent.Flow;

// 被观察者类
class MyPublisher extends SubmissionPublisher<String> {
    // 继承 SubmissionPublisher，表示一个简单的发布者
}

// 观察者类
class MySubscriber implements Flow.Subscriber<String> {
    private Flow.Subscription subscription;
    private final String name; // 观察者名称

    public MySubscriber(String name) {
        this.name = name;
    }

    @Override
    public void onSubscribe(Flow.Subscription subscription) {
        this.subscription = subscription;
        System.out.println(name + " 订阅成功");
        // 请求第一个数据项
        subscription.request(1);
    }

    @Override
    public void onNext(String item) {
        System.out.println(name + " 收到消息: " + item);
        // 请求下一个数据项
        subscription.request(1);
    }

    @Override
    public void onError(Throwable throwable) {
        System.err.println(name + " 收到错误: " + throwable);
    }

    @Override
    public void onComplete() {
        System.out.println(name + " 接收完成");
    }
}

public class Main {
    public static void main(String[] args) throws InterruptedException {
        // 创建发布者（被观察者）
        MyPublisher publisher = new MyPublisher();

        // 创建两个观察者
        MySubscriber subscriber1 = new MySubscriber("观察者1");
        MySubscriber subscriber2 = new MySubscriber("观察者2");

        // 将观察者订阅到发布者
        publisher.subscribe(subscriber1);
        publisher.subscribe(subscriber2);

        // 发布消息（观察者会接收）
        publisher.submit("消息 1");
        publisher.submit("消息 2");

        // 关闭发布者
        publisher.close();

        // 等待观察者完成接收
        Thread.sleep(1000);
    }
}

```

## 源码

- java.awt.event
- RequestContextListener
- 想看观察者模式可以看 java.util.EventListener，监听器是观察者实现的一种，也有称为发布订阅
- guava 也提供了友好的实现，EventBus

# 备忘录模式

## 定义

![](image/Pasted%20image%2020250101211452.png)

## 适用场景

![](image/Pasted%20image%2020250101211507.png)

## 优点

![](image/Pasted%20image%2020250101211523.png)

## 缺点

![](image/Pasted%20image%2020250101211549.png)

## 相关设计模式

![](image/Pasted%20image%2020250101211615.png)

## 代码

![](image/Pasted%20image%2020250102155019.png)

```java
public class Article {  
    private String titile;  
    private String content;  
    private String imgs;  
  
    public Article(String titile, String content, String imgs) {  
        this.titile = titile;  
        this.content = content;  
        this.imgs = imgs;  
    }  
  
    public String getTitile() {  
        return titile;  
    }  
  
    public void setTitile(String titile) {  
        this.titile = titile;  
    }  
  
    public String getContent() {  
        return content;  
    }  
  
    public void setContent(String content) {  
        this.content = content;  
    }  
  
    public String getImgs() {  
        return imgs;  
    }  
  
    public void setImgs(String imgs) {  
        this.imgs = imgs;  
    }  
  
    @Override  
    public String toString() {  
        return "Article{" +  
                "titile='" + titile + '\'' +  
                ", content='" + content + '\'' +  
                ", imgs='" + imgs + '\'' +  
                '}';  
    }  
  
    public ArticleMemento saveToMemento() {  
        return new ArticleMemento(this);  
    }  
  
    public void undoFromMemento(ArticleMemento articleMemento) {  
  
        this.titile = articleMemento.getTitile();  
        this.content = articleMemento.getContent();  
        this.imgs = articleMemento.getImgs();  
    }  
}

public class ArticleMemento {  
    private String titile;  
    private String content;  
    private String imgs;  
  
    public ArticleMemento(Article article) {  
        this.titile = article.getTitile();  
        this.content = article.getContent();  
        this.imgs = article.getImgs();  
    }  
  
    public String getTitile() {  
        return titile;  
    }  
  
    public String getContent() {  
        return content;  
    }  
  
  
    public String getImgs() {  
        return imgs;  
    }  
  
    @Override  
    public String toString() {  
        return "ArticleMemento{" +  
                "titile='" + titile + '\'' +  
                ", content='" + content + '\'' +  
                ", imgs='" + imgs + '\'' +  
                '}';  
    }  
}

public class ArticleMementoManager {  
  
    private final Stack<ArticleMemento> ARTICLE_MEMENTO_STACK = new Stack<>();  
  
    public void addMemento(ArticleMemento articleMemento) {  
        ARTICLE_MEMENTO_STACK.push(articleMemento);  
    }  
  
    public ArticleMemento getMemento() {  
        return ARTICLE_MEMENTO_STACK.pop();  
    }  
}

public class Test {  
    public static void main(String[] args) {  
        ArticleMementoManager manager = new ArticleMementoManager();  
  
        Article article = new Article("标题一", "内容一", "图像一");  
  
        ArticleMemento memento = article.saveToMemento();  
        manager.addMemento(memento);  
  
        article.setContent("内容二");  
        System.out.println(article);  
        ArticleMemento memento1 = manager.getMemento();  
        article.undoFromMemento(memento1);  
        System.out.println(article);  
    }  
}
```

## 源码

- Spring 里的 webflow 里 StateManageableMessageContext 里的 createMessagesMemento 方法
- 常见于流程处理

# 命令模式

## 定义

![](image/Pasted%20image%2020250101211955.png)

## 适用场景

![](image/Pasted%20image%2020250101212029.png)

## 优点

![](image/Pasted%20image%2020250101212039.png)

## 缺点

![](image/Pasted%20image%2020250101212054.png)

## 相关设计模式

![](image/Pasted%20image%2020250101212115.png)

## 代码

![](image/Pasted%20image%2020250102185359.png)

```java
public interface Command {  
    void execute();  
}

public class CourseVideo {  
    private String name;  
  
    public CourseVideo(String name) {  
        this.name = name;  
    }  
  
    public String getName() {  
        return name;  
    }  
  
    public void setName(String name) {  
        this.name = name;  
    }  
  
    public void open(){  
        System.out.println(this.name + "课程视频开放");  
    }  
    public void close(){  
        System.out.println(this.name + "课程视频关闭");  
    }  
}

public class OpenCourseVideoCommand implements Command {  
  
    private CourseVideo courseVideo;  
  
    public OpenCourseVideoCommand(CourseVideo courseVideo) {  
        this.courseVideo = courseVideo;  
    }  
  
    @Override  
    public void execute() {  
        courseVideo.open();  
    }  
}

public class CloseCourseVideoCommand implements Command {  
    private CourseVideo courseVideo;  
  
    public CloseCourseVideoCommand(CourseVideo courseVideo) {  
        this.courseVideo = courseVideo;  
    }  
  
  
  
    @Override  
    public void execute() {  
        courseVideo.close();  
    }  
}

public class Stuff {  
    private List<Command> commandList = new ArrayList<>();  
  
    public void addCommand(Command command) {  
        commandList.add(command);  
    }  
  
    public void executeCommands() {  
        for(Command command  : commandList){  
            command.execute();  
        }  
        commandList.clear();  
    }  
}

public class Test {  
    public static void main(String[] args) {  
        Stuff stuff = new Stuff();  
  
        CourseVideo video = new CourseVideo("Java");  
        Command openCommand = new OpenCourseVideoCommand(video);  
        Command closeCommand = new CloseCourseVideoCommand(video);  
  
        stuff.addCommand(openCommand);  
        stuff.addCommand(closeCommand);  
  
        stuff.executeCommands();  
    }  
}
```

## 源码

- Runnable 接口，相当于抽象的命令
- junit test 接口

# 中介者模式

## 定义

![](image/Pasted%20image%2020250101212425.png)

## 适用场景

![](image/Pasted%20image%2020250101212440.png)

## 优点

![](image/Pasted%20image%2020250101212517.png)

## 缺点

![](image/Pasted%20image%2020250101212527.png)

## 相关设计模式

- 通过观察者实现中介者角色间的通信

![](image/Pasted%20image%2020250101212552.png)

## 代码

```java
public class User {  
    private String name;  
  
    public String getName() {  
        return name;  
    }  
  
    public void setName(String name) {  
        this.name = name;  
    }  
  
    public User(String name) {  
        this.name = name;  
    }  
  
    public void sendMessage(String message) {  
        StudyGroup.showMessage(this,message);  
    }  
}

public class StudyGroup {  
    public static void showMessage(User user, String message) {  
        System.out.println(new Date().toString() + " [" + user.getName() + "] " + message);  
    }  
}

public class Test {  
    public static void main(String[] args) {  
        User han = new User("Han");  
        User xiao = new User("Xiao");  
  
        han.sendMessage("Han");  
        xiao.sendMessage("Xiao");  
  
    }  
}
```

## 源码

- java.util.timer 主要是 schedule 方法，最后都是调用 sched 方法

# 责任链模式

## 定义

![](image/Pasted%20image%2020250101231307.png)

## 适用场景

![](image/Pasted%20image%2020250101231337.png)

## 优点

![](image/Pasted%20image%2020250101231346.png)

## 缺点

![](image/Pasted%20image%2020250101231401.png)

## 相关设计模式

![](image/Pasted%20image%2020250101231425.png)

## 代码

![](image/Pasted%20image%2020250102194535.png)

```java
public class Course {  
    private String name;  
    private String article;  
    private String video;  
  
    public Course(String name, String article, String video) {  
        this.name = name;  
        this.article = article;  
        this.video = video;  
    }  
  
    public String getName() {  
        return name;  
    }  
  
    public void setName(String name) {  
        this.name = name;  
    }  
  
    public String getArticle() {  
        return article;  
    }  
  
    public void setArticle(String article) {  
        this.article = article;  
    }  
  
    public String getVideo() {  
        return video;  
    }  
  
    public void setVideo(String video) {  
        this.video = video;  
    }  
  
    @Override  
    public String toString() {  
        return "Course{" +  
                "name='" + name + '\'' +  
                ", article='" + article + '\'' +  
                ", video='" + video + '\'' +  
                '}';  
    }  
}

public abstract class Approver {  
    protected  Approver approver;  
  
    public void setNextApprover(Approver approver) {  
        this.approver = approver;  
  
    }  
  
    public abstract void deploy(Course course);  
}

public class ArticleApprover extends Approver{  
    @Override  
    public void deploy(Course course) {  
        if (!StringUtils.isEmpty(course.getArticle())) {  
            System.out.println(course.getName() + "含有手记，批准");  
            if (!Objects.isNull(approver)) {  
                approver.deploy(course);  
            }  
        } else {  
            System.out.println(course.getName() + "没有手记，不批准");  
        }  
    }  
}

    @Override  
    public void deploy(Course course) {  
        if (!StringUtils.isEmpty(course.getVideo())) {  
            System.out.println(course.getName() + "含有视屏，批准");  
            if (!Objects.isNull(approver)) {  
                approver.deploy(course);  
            }  
        } else {  
            System.out.println(course.getName() + "没有视频，不批准");  
        }  
    }  
}

public class Test {  
    public static void main(String[] args) {  
        ArticleApprover articleApprover = new ArticleApprover();  
        VideoApprover videoApprover = new VideoApprover();  
        Course course = new Course("Java","文章","视屏");  
  
        articleApprover.setNextApprover(videoApprover);  
        articleApprover.deploy(course);  
    }  
}

```

## 源码

- javax.servlet.Filter doFilter 方法
- 看 javax.servlet.Filter 实现的类就行了

# 访问者模式

## 定义

![](image/Pasted%20image%2020250101232157.png)

## 适用场景

![](image/Pasted%20image%2020250101232220.png)

## 优点

![](image/Pasted%20image%2020250101232236.png)

## 缺点

![](image/Pasted%20image%2020250101232244.png)

## 相关设计模式

![](image/Pasted%20image%2020250101232301.png)

## 代码

![](image/Pasted%20image%2020250102224209.png)

```java
public abstract class Course {  
    private String name;  
  
    public String getName() {  
        return name;  
    }  
  
    public void setName(String name) {  
        this.name = name;  
    }  
  
    public abstract void accept(IVisitor visitor);  
}

public class CodingCourse extends Course{  
  
    private int price;  
  
    public int getPrice() {  
        return price;  
    }  
  
    public void setPrice(int price) {  
        this.price = price;  
    }  
  
    @Override  
    public void accept(IVisitor visitor) {  
        visitor.visit(this);  
    }  
}

public class FreeCourse extends Course{  
  
    @Override  
    public void accept(IVisitor visitor) {  
        visitor.visit(this);  
    }  
}

public interface IVisitor {  
    void visit(FreeCourse freeCourse);  
  
    void visit(CodingCourse codingCourse);  
}

public class Visitor implements IVisitor{  
    @Override  
    public void visit(FreeCourse freeCourse) {  
        System.out.println("免费课程：" + freeCourse.getName());  
    }  
  
    @Override  
    public void visit(CodingCourse codingCourse) {  
        System.out.println("实战课程：" + codingCourse.getName() + "价格：" + codingCourse.getPrice() + "元");  
    }  
}

public class Test {  
    public static void main(String[] args) {  
        List<Course> courseList = new ArrayList<>();  
  
        FreeCourse freeCourse = new FreeCourse();  
        freeCourse.setName("SpringMVC数据绑定");  
  
        CodingCourse codingCourse = new CodingCourse();  
        codingCourse.setName("设计模式");  
        codingCourse.setPrice(299);  
  
        courseList.add(freeCourse);  
        courseList.add(codingCourse);  
  
        courseList.forEach((course) -> {  
            course.accept(new Visitor());  
        });  
    }  
}
```

## 源码

- java.nio.FileVisiror 用这个访问文件树很方便
- Spring 中的 BeanDefinitionVisitor

# 状态模式

## 定义

![](image/Pasted%20image%2020250101232753.png)

## 适用场景

![](image/Pasted%20image%2020250101232804.png)

## 优点

![](image/Pasted%20image%2020250101232837.png)

## 缺点

![](image/Pasted%20image%2020250101232846.png)

## 相关设计模式

![](image/Pasted%20image%2020250101232900.png)

## 代码

![](image/Pasted%20image%2020250103002647.png)

```java
public class CourseVideoContext {  
    private CourseVideoState courseVideoState;  
    public final static PlayState PLAY_STATE = new PlayState();  
    public final static StopState STOP_STATE = new StopState();  
    public final static PauseState PAUSE_STATE = new PauseState();  
    public final static SpeedState SPEED_STATE = new SpeedState();  
  
    public CourseVideoState getCourseVideoState() {  
        return courseVideoState;  
    }  
  
    public void setCourseVideoState(CourseVideoState courseVideoState) {  
        this.courseVideoState = courseVideoState;  
        this.courseVideoState.setContext(this);  
    }  
  
  
    public void play() {  
        this.courseVideoState.play();  
    }  
  
  
    public void speed() {  
        this.courseVideoState.speed();  
    }  
  
  
    public void pause() {  
        this.courseVideoState.pause();  
    }  
  
  
    public void stop() {  
        this.courseVideoState.stop();  
    }  
}

public abstract class CourseVideoState {  
    protected CourseVideoContext context;  
  
  
    public void setContext(CourseVideoContext context) {  
        this.context = context;  
    }  
  
    public abstract  void play();  
    public abstract  void speed();  
    public abstract  void pause();  
    public abstract  void stop();  
}

public class PauseState extends CourseVideoState{  
  
  
    @Override  
    public void play() {  
        super.context.setCourseVideoState(CourseVideoContext.PLAY_STATE);  
    }  
  
    @Override  
    public void speed() {  
        super.context.setCourseVideoState(CourseVideoContext.SPEED_STATE);  
    }  
  
    @Override  
    public void pause() {  
        System.out.println("暂停播放视频状态");  
    }  
  
    @Override  
    public void stop() {  
        super.context.setCourseVideoState(CourseVideoContext.STOP_STATE);  
    }  
}

public class PlayState extends CourseVideoState{  
    @Override  
    public void play() {  
        System.out.println("正常播放视频状态");  
    }  
  
    @Override  
    public void speed() {  
        super.context.setCourseVideoState(CourseVideoContext.SPEED_STATE);  
    }  
  
    @Override  
    public void pause() {  
        super.context.setCourseVideoState(CourseVideoContext.PAUSE_STATE);  
    }  
  
    @Override  
    public void stop() {  
        super.context.setCourseVideoState(CourseVideoContext.STOP_STATE);  
    }  
}

public class SpeedState extends CourseVideoState{  
    @Override  
    public void play() {  
        super.context.setCourseVideoState(CourseVideoContext.PLAY_STATE);  
    }  
  
    @Override  
    public void speed() {  
        System.out.println("快进播放视频状态");  
    }  
  
    @Override  
    public void pause() {  
        super.context.setCourseVideoState(CourseVideoContext.PAUSE_STATE);  
    }  
  
    @Override  
    public void stop() {  
        super.context.setCourseVideoState(CourseVideoContext.STOP_STATE);  
    }  
}

public class StopState extends CourseVideoState {  
    @Override  
    public void play() {  
        super.context.setCourseVideoState(CourseVideoContext.PLAY_STATE);  
    }  
  
    @Override  
    public void speed() {  
        System.out.println("ERROR 停止状态不能快进！！");  
    }  
  
    @Override  
    public void pause() {  
        System.out.println("ERROR 停止状态不能暂停！！");  
    }  
  
    @Override  
    public void stop() {  
        System.out.println("停止播放视频状态");  
    }  
}

public class Test {  
    public static void main(String[] args) {  
        CourseVideoContext context = new CourseVideoContext();  
        context.setCourseVideoState(new PlayState());  
        System.out.println("当前状态" + context.getCourseVideoState().getClass().getSimpleName());  
  
        context.pause();  
        System.out.println("当前状态" + context.getCourseVideoState().getClass().getSimpleName());  
  
        context.speed();  
        System.out.println("当前状态" + context.getCourseVideoState().getClass().getSimpleName());  
  
        context.stop();  
        System.out.println("当前状态" + context.getCourseVideoState().getClass().getSimpleName());  
  
        context.pause();  
        System.out.println("当前状态" + context.getCourseVideoState().getClass().getSimpleName());  
    }  
}
```

## 源码

- 和业务场景有关
- javax.face.lifecycle 里面的 execute 方法