# 简单工厂

## 定义与类型

![](image/Pasted%20image%2020241226230713.png)

## 使用场景

![](image/Pasted%20image%2020241226230726.png)

## 优点

![](image/Pasted%20image%2020241226230747.png)

## 缺点

![](image/Pasted%20image%2020241226230816.png)

## 代码

![](image/Pasted%20image%2020241227123310.png)

```java
public class JavaVideo extends Video {
    @Override
    public void produce() {
        System.out.println("录制Java课程视频");
    }
}

public class PythonVideo extends Video {
    @Override
    public void produce() {
        System.out.println("录制Python课程视频");
    }
}

public abstract class Video {
    public abstract void produce();

}


public class VideoFactory {
    public Video getVideo(Class c){
        Video video = null;
        try {
            video = (Video) Class.forName(c.getName()).newInstance();
        } catch (InstantiationException e) {
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        }
        return video;
    }


    public Video getVideo(String type){
        if("java".equalsIgnoreCase(type)){
            return new JavaVideo();
        }else if("python".equalsIgnoreCase(type)){
            return new PythonVideo();
        }
        return null;
    }

}

public class Test {
    public static void main(String[] args) {
//        VideoFactory videoFactory = new VideoFactory();
//        Video video = videoFactory.getVideo("java");
//        if(video == null){
//            return;
//        }
//        video.produce();

        VideoFactory videoFactory = new VideoFactory();
        Video video = videoFactory.getVideo(JavaVideo.class);
        if(video == null){
            return;
        }
        video.produce();



    }

}

```

## JDK 源码

- 在 Calendar 类的 getInstance 方法

![](image/Pasted%20image%2020241227125054.png)

```java
public static Calendar getInstance()  
{  
    Locale aLocale = Locale.getDefault(Locale.Category.FORMAT);  
    return createCalendar(defaultTimeZone(aLocale), aLocale);  
}

private static Calendar createCalendar(TimeZone zone,  
                                       Locale aLocale)  
{  
    CalendarProvider provider =  
        LocaleProviderAdapter.getAdapter(CalendarProvider.class, aLocale)  
                             .getCalendarProvider();  
    if (provider != null) {  
        try {  
            return provider.getInstance(zone, aLocale);  
        } catch (IllegalArgumentException iae) {  
            // fall back to the default instantiation  
        }  
    }  
  
    Calendar cal = null;  
  
    if (aLocale.hasExtensions()) {  
        String caltype = aLocale.getUnicodeLocaleType("ca");  
        if (caltype != null) {  
            cal = switch (caltype) {  
                case "buddhist" -> new BuddhistCalendar(zone, aLocale);  
                case "japanese" -> new JapaneseImperialCalendar(zone, aLocale);  
                case "gregory"  -> new GregorianCalendar(zone, aLocale);  
                default         -> null;  
            };  
        }  
    }  
    if (cal == null) {  
            cal = new BuddhistCalendar(zone, aLocale);  
        } else if (aLocale.getVariant() == "JP" && aLocale.getLanguage() == "ja"  
                   && aLocale.getCountry() == "JP") {  
            cal = new JapaneseImperialCalendar(zone, aLocale);  
        } else {  
            cal = new GregorianCalendar(zone, aLocale);  
        }  
    }  
    return cal;  
}
```

# 工厂方法

## 定义

![](image/Pasted%20image%2020241227125402.png)

![](image/Pasted%20image%2020241227125504.png)

## 优点

![](image/Pasted%20image%2020241227125550.png)

## 缺点

![](image/Pasted%20image%2020241227125644.png)

## 代码

![](image/Pasted%20image%2020241227130341.png)

```java
public abstract class Video {
    public abstract void produce();

}

public class FEVideo extends Video{
    @Override
    public void produce() {
        System.out.println("录制FE课程视频");
    }
}

public class JavaVideo extends Video {
    @Override
    public void produce() {
        System.out.println("录制Java课程视频");
    }
}

public class PythonVideo extends Video {
    @Override
    public void produce() {
        System.out.println("录制Python课程视频");
    }
}

public abstract class VideoFactory {

    public abstract Video getVideo();
}

public class FEVideoFactory extends VideoFactory{
    @Override
    public Video getVideo() {
        return new FEVideo();
    }
}

public class JavaVideoFactory extends VideoFactory {
    @Override
    public Video getVideo() {
        return new JavaVideo();
    }
}

public class PythonVideoFactory extends VideoFactory {
    @Override
    public Video getVideo() {
        return new PythonVideo();
    }
}


public class Test {
    public static void main(String[] args) {
        VideoFactory videoFactory = new PythonVideoFactory();
        VideoFactory videoFactory2 = new JavaVideoFactory();
        VideoFactory videoFactory3 = new FEVideoFactory();
        Video video = videoFactory.getVideo();
        video.produce();
    }
}
```

## JDK 源码

- Collection 接口中的 iterator 方法，这是一个工厂方法，整个 Collection 可以理解为抽象工厂，现在关注工厂方法

```java
/**  
 * Returns an iterator over the elements in this collection.  
 * There are no guarantees concerning the order in which the elements are returned .
 * (unless this collection is an instance of some class that provides a 
 * guarantee). 
 * @return an {@code Iterator} over the elements in this collection  
 */Iterator<E> iterator();

// 这是 ArrayList 的实现

    @Override  
public Iterator<E> iterator() {  
        return new ArrayItr<>(a);  
    }  
}

private static class ArrayItr<E> implements Iterator<E> {  
    private int cursor;  
    private final E[] a;  
  
    ArrayItr(E[] a) {  
        this.a = a;  
    }  
  
    @Override  
    public boolean hasNext() {  
        return cursor < a.length;  
    }  
  
    @Override  
    public E next() {  
        int i = cursor;  
        if (i >= a.length) {  
            throw new NoSuchElementException();  
        }  
        cursor = i + 1;  
        return a[i];  
    }  
}

```

- URLStreamHandlerFactory 用来解决 url 协议扩展

```java
public interface URLStreamHandlerFactory {  
    /**  
     * Creates a new {@code URLStreamHandler} instance with the specified  
     * protocol.     
     *    
     * @param   protocol   the protocol ("{@code ftp}",  "{@code http}", "{@code nntp}", etc.).  
     * @return  a {@code URLStreamHandler} for the specific protocol, or {@code null} if this factory cannot create a handler for the specific protocol     
     * @see java.net.URLStreamHandler  
     */  
    URLStreamHandler createURLStreamHandler(String protocol);  
}

private static class DefaultFactory implements URLStreamHandlerFactory {  
    private static String PREFIX = "sun.net.www.protocol.";  
  
    public URLStreamHandler createURLStreamHandler(String protocol) {  
        // Avoid using reflection during bootstrap  
        switch (protocol) {  
            case "file":  
                return new sun.net.www.protocol.file.Handler();  
            case "jar":  
                return new sun.net.www.protocol.jar.Handler();  
            case "jrt":  
                return new sun.net.www.protocol.jrt.Handler();  
        }  
        String name = PREFIX + protocol + ".Handler";  
        try {  
            Object o = Class.forName(name).getDeclaredConstructor().newInstance();  
            return (URLStreamHandler)o;  
        } catch (Exception e) {  
            // For compatibility, all Exceptions are ignored.  
            // any number of exceptions can get thrown here        }  
        return null;  
    }  
}

// package sun.net.www.protocol.http;
public class Handler extends java.net.URLStreamHandler {  
    protected String proxy;  
    protected int proxyPort;  
  
    protected int getDefaultPort() {  
        return 80;  
    }  
  
    public Handler () {  
        proxy = null;  
        proxyPort = -1;  
    }  
  
    public Handler (String proxy, int port) {  
        this.proxy = proxy;  
        this.proxyPort = port;  
    }  
  
    protected java.net.URLConnection openConnection(URL u)  
    throws IOException {  
        return openConnection(u, (Proxy)null);  
    }  
  
    protected java.net.URLConnection openConnection(URL u, Proxy p)  
        throws IOException {  
        return new HttpURLConnection(u, p, this);  
    }  
}
```

## Logback 源码

- 在 LoggerFactory 中的 getLogger 方法，使用了工厂方法

```java
public static Logger getLogger(String name) {  
    ILoggerFactory iLoggerFactory = getILoggerFactory();  
    return iLoggerFactory.getLogger(name);  
}

public interface ILoggerFactory {  
  
    /**  
     * Return an appropriate {@link Logger} instance as specified by the  
     * <code>name</code> parameter.  
     ** <p>If the name parameter is equal to {@link Logger#ROOT_LOGGER_NAME}, that is   
     * the string value "ROOT" (case insensitive), then the root logger of the   
     * underlying logging system is returned.  
     ** <p>Null-valued name arguments are considered invalid.  
     *     * <p>Certain extremely simple logging systems, e.g. NOP, may always  
     * return the same logger instance regardless of the requested name.     ** @param name the name of the Logger to return  
     * @return a Logger instance   
     */  
    public Logger getLogger(String name);  
}
```

# 抽象工厂

## 定义

![](image/Pasted%20image%2020241227133915.png)

## 适用场景

![](image/Pasted%20image%2020241227134047.png)

## 优点

![](image/Pasted%20image%2020241227134102.png)

## 缺点

![](image/Pasted%20image%2020241227134132.png)

## 产品等级和产品族

- 竖着都是同一个产品等级，比如空调，不在乎牌子，都是实现一样的事情，制冷
- 横着是一个产品族，通常是空调，冰箱，都是同一个品牌
- 工厂方法是针对产品等级结构
- 抽象工厂方法是针对产品族

![](image/Pasted%20image%2020241227134247.png)

![](image/Pasted%20image%2020241227134656.png)

## 代码

- 这个主要是生成捆绑在一起的产品族

![](image/Pasted%20image%2020241227154308.png)

```java
public abstract class Video {
    public abstract void produce();

}

public abstract class Article {
    public abstract void produce();
}

public interface CourseFactory {
    Video getVideo();
    Article getArticle();

}

public class JavaArticle extends Article {
    @Override
    public void produce() {
        System.out.println("编写Java课程手记");
    }
}

public class JavaVideo extends Video {
    @Override
    public void produce() {
        System.out.println("录制Java课程视频");
    }
}

public class JavaCourseFactory implements CourseFactory {
    @Override
    public Video getVideo() {
        return new JavaVideo();
    }

    @Override
    public Article getArticle() {
        return new JavaArticle();
    }
}

public class PythonArticle extends Article {
    @Override
    public void produce() {
        System.out.println("编写Python课程手记");
    }
}

public class PythonVideo extends Video {
    @Override
    public void produce() {
        System.out.println("录制Python课程视频");
    }
}

public class PythonCourseFactory implements CourseFactory {
    @Override
    public Video getVideo() {
        return new PythonVideo();
    }

    @Override
    public Article getArticle() {
        return new PythonArticle();
    }
}

public class Test {
    public static void main(String[] args) {
        CourseFactory courseFactory = new JavaCourseFactory();
        Video video = courseFactory.getVideo();
        Article article = courseFactory.getArticle();
        video.produce();
        article.produce();
    }
}
```

## 源码

- 在 java.sql.Connection 这个接口对应返回的就是同一产品族，都是同一个数据库对应的对象
- 在 Mybatis 的 SqlSessionFactory 也是一样的

# 建造者模式

## 定义

![](image/Pasted%20image%2020241227162934.png)

## 适用场景

- 建造者更在乎调用顺序，工厂在乎创建产品
- 工厂创建都是一个样子，建造者可以创造出不同的产品
- 工厂在乎创建出来，建造者在乎创建步骤

![](image/Pasted%20image%2020241227163024.png)

## 优点

![](image/Pasted%20image%2020241227163111.png)

## 缺点

![](image/Pasted%20image%2020241227163136.png)

## 代码

- v1

![](image/Pasted%20image%2020241227165901.png)

```java
public class Course {
    private String courseName;
    private String coursePPT;
    private String courseVideo;
    private String courseArticle;

    //question & answer
    private String courseQA;

    public String getCourseName() {
        return courseName;
    }

    public void setCourseName(String courseName) {
        this.courseName = courseName;
    }

    public String getCoursePPT() {
        return coursePPT;
    }

    public void setCoursePPT(String coursePPT) {
        this.coursePPT = coursePPT;
    }

    public String getCourseVideo() {
        return courseVideo;
    }

    public void setCourseVideo(String courseVideo) {
        this.courseVideo = courseVideo;
    }

    public String getCourseArticle() {
        return courseArticle;
    }

    public void setCourseArticle(String courseArticle) {
        this.courseArticle = courseArticle;
    }

    public String getCourseQA() {
        return courseQA;
    }

    public void setCourseQA(String courseQA) {
        this.courseQA = courseQA;
    }

    @Override
    public String toString() {
        return "Course{" +
                "courseName='" + courseName + '\'' +
                ", coursePPT='" + coursePPT + '\'' +
                ", courseVideo='" + courseVideo + '\'' +
                ", courseArticle='" + courseArticle + '\'' +
                ", courseQA='" + courseQA + '\'' +
                '}';
    }
}

public abstract class CourseBuilder {

    public abstract void buildCourseName(String courseName);
    public abstract void buildCoursePPT(String coursePPT);
    public abstract void buildCourseVideo(String courseVideo);
    public abstract void buildCourseArticle(String courseArticle);
    public abstract void buildCourseQA(String courseQA);

    public abstract Course makeCourse();

}

public class CourseActualBuilder extends CourseBuilder {

    private Course course = new Course();


    @Override
    public void buildCourseName(String courseName) {
        course.setCourseName(courseName);
    }

    @Override
    public void buildCoursePPT(String coursePPT) {
        course.setCoursePPT(coursePPT);
    }

    @Override
    public void buildCourseVideo(String courseVideo) {
        course.setCourseVideo(courseVideo);
    }

    @Override
    public void buildCourseArticle(String courseArticle) {
        course.setCourseArticle(courseArticle);
    }

    @Override
    public void buildCourseQA(String courseQA) {
        course.setCourseQA(courseQA);
    }

    @Override
    public Course makeCourse() {
        return course;
    }
}

public class Coach {
    private CourseBuilder courseBuilder;

    public void setCourseBuilder(CourseBuilder courseBuilder) {
        this.courseBuilder = courseBuilder;
    }

    public Course makeCourse(String courseName,String coursePPT,
                             String courseVideo,String courseArticle,
                             String courseQA){
        this.courseBuilder.buildCourseName(courseName);
        this.courseBuilder.buildCoursePPT(coursePPT);
        this.courseBuilder.buildCourseVideo(courseVideo);
        this.courseBuilder.buildCourseArticle(courseArticle);
        this.courseBuilder.buildCourseQA(courseQA);
        return this.courseBuilder.makeCourse();
    }
}


public class Test {
    public static void main(String[] args) {
        CourseBuilder courseBuilder = new CourseActualBuilder();
        Coach coach = new Coach();
        coach.setCourseBuilder(courseBuilder);

        Course course = coach.makeCourse("Java设计模式精讲",
                "Java设计模式精讲PPT",
                "Java设计模式精讲视频",
                "Java设计模式精讲手记",
                "Java设计模式精讲问答");
        System.out.println(course);

    }
}
```

- v2 链式调用

![](image/Pasted%20image%2020241227170148.png)

```java
public class Course {

    private String courseName;
    private String coursePPT;
    private String courseVideo;
    private String courseArticle;

    //question & answer
    private String courseQA;

    public Course(CourseBuilder courseBuilder) {
        this.courseName = courseBuilder.courseName;
        this.coursePPT = courseBuilder.coursePPT;
        this.courseVideo = courseBuilder.courseVideo;
        this.courseArticle = courseBuilder.courseArticle;
        this.courseQA = courseBuilder.courseQA;
    }


    @Override
    public String toString() {
        return "Course{" +
                "courseName='" + courseName + '\'' +
                ", coursePPT='" + coursePPT + '\'' +
                ", courseVideo='" + courseVideo + '\'' +
                ", courseArticle='" + courseArticle + '\'' +
                ", courseQA='" + courseQA + '\'' +
                '}';
    }

    public static class CourseBuilder{
        private String courseName;
        private String coursePPT;
        private String courseVideo;
        private String courseArticle;

        //question & answer
        private String courseQA;

        public CourseBuilder buildCourseName(String courseName){
            this.courseName = courseName;
            return this;
        }


        public CourseBuilder buildCoursePPT(String coursePPT) {
            this.coursePPT = coursePPT;
            return this;
        }

        public CourseBuilder buildCourseVideo(String courseVideo) {
            this.courseVideo = courseVideo;
            return this;
        }

        public CourseBuilder buildCourseArticle(String courseArticle) {
            this.courseArticle = courseArticle;
            return this;
        }

        public CourseBuilder buildCourseQA(String courseQA) {
            this.courseQA = courseQA;
            return this;
        }

        public Course build(){
            return new Course(this);
        }



    }
}


public class Test {
    public static void main(String[] args) {
        Course course = new Course.CourseBuilder().buildCourseName("Java设计模式精讲").buildCoursePPT("Java设计模式精讲PPT").buildCourseVideo("Java设计模式精讲视频").build();
        System.out.println(course);

        Set<String> set = ImmutableSet.<String>builder().add("a").add("b").build();

        System.out.println(set);
    }
}

```

## 源码

- SpringBuilder 从名字就看得出是建造者
- guava 中的 Immutable 类
- Spring 的 BeanDefinitionBuilder
- SqlSessionFactoryBuilder

# 单例模式

## 定义

![](image/Pasted%20image%2020241227180251.png)

## 适用场景

![](image/Pasted%20image%2020241227180402.png)

## 优点

![](image/Pasted%20image%2020241227180422.png)

## 缺点

![](image/Pasted%20image%2020241227180433.png)

## 重点

![](image/Pasted%20image%2020241227181021.png)

## 静态内部类



## 实用技能

![](image/Pasted%20image%2020241227182554.png)

## 相关设计模式

![](image/Pasted%20image%2020241227182621.png)

## 代码实现

### 懒汉式

```java
public class LazySingleton {
    private static LazySingleton lazySingleton = null;
    private LazySingleton(){
        if(lazySingleton != null){
            throw new RuntimeException("单例构造器禁止反射调用");
        }
    }
    public synchronized static LazySingleton getInstance(){
        if(lazySingleton == null){
            lazySingleton = new LazySingleton();
        }
        return lazySingleton;
    }
}
```

### 双重检查

```java
public class LazyDoubleCheckSingleton {
    private volatile static LazyDoubleCheckSingleton lazyDoubleCheckSingleton = null;
    private LazyDoubleCheckSingleton(){

    }
    public static LazyDoubleCheckSingleton getInstance(){
        if(lazyDoubleCheckSingleton == null){
            synchronized (LazyDoubleCheckSingleton.class){
                if(lazyDoubleCheckSingleton == null){
                    lazyDoubleCheckSingleton = new LazyDoubleCheckSingleton();
                    //1.分配内存给这个对象
//                  //3.设置lazyDoubleCheckSingleton 指向刚分配的内存地址
                    //2.初始化对象
//                    intra-thread semantics
//                    ---------------//3.设置lazyDoubleCheckSingleton 指向刚分配的内存地址
                }
            }
        }
        return lazyDoubleCheckSingleton;
    }
}

```

- 发生了指令重排序，线程 1 比线程 0 更早的访问了对象，此时对象未初始化
	- 可以让 2 和 3 不重排序，使用 volatile

![](image/Pasted%20image%2020241227184442.png)

![](image/Pasted%20image%2020241227182511.png)

### 静态内部类

![](image/Pasted%20image%2020241227182526.png)

```java
public class StaticInnerClassSingleton {
    private static class InnerClass{
        private static StaticInnerClassSingleton staticInnerClassSingleton = new StaticInnerClassSingleton();
    }
    public static StaticInnerClassSingleton getInstance(){
        return InnerClass.staticInnerClassSingleton;
    }
    private StaticInnerClassSingleton(){
        if(InnerClass.staticInnerClassSingleton != null){
            throw new RuntimeException("单例构造器禁止反射调用");
        }
    }


}

```

### 饿汉式

```java
public class HungrySingleton implements Serializable,Cloneable{

    private final static HungrySingleton hungrySingleton;

    static{
        hungrySingleton = new HungrySingleton();
    }
    private HungrySingleton(){
        if(hungrySingleton != null){
            throw new RuntimeException("单例构造器禁止反射调用");
        }
    }
    public static HungrySingleton getInstance(){
        return hungrySingleton;
    }

    private Object readResolve(){
        return hungrySingleton;
    }

    @Override
    protected Object clone() throws CloneNotSupportedException {
        return getInstance();
    }
}
```

### Enum （推荐）

- 避免反射
- 避免序列化

```java
public enum EnumInstance {
    INSTANCE{
        protected  void printTest(){
            System.out.println("Geely Print Test");
        }
    };
    protected abstract void printTest();
    private Object data;

    public Object getData() {
        return data;
    }

    public void setData(Object data) {
        this.data = data;
    }
    public static EnumInstance getInstance(){
        return INSTANCE;
    }

}
```

### 容器单例

```java
public class ContainerSingleton {

    private ContainerSingleton(){

    }
    private static Map<String,Object> singletonMap = new HashMap<String,Object>();

    public static void putInstance(String key,Object instance){
        if(StringUtils.isNotBlank(key) && instance != null){
            if(!singletonMap.containsKey(key)){
                singletonMap.put(key,instance);
            }
        }
    }

    public static Object getInstance(String key){
        return singletonMap.get(key);
    }
}
```

### 线程唯一单例

```java
public class ThreadLocalInstance {

    private static final ThreadLocal<ThreadLocalInstance> threadLocalInstanceThreadLocal
             = new ThreadLocal<ThreadLocalInstance>(){
        @Override
        protected ThreadLocalInstance initialValue() {
            return new ThreadLocalInstance();
        }
    };
    private ThreadLocalInstance(){

    }

    public static ThreadLocalInstance getInstance(){
        return threadLocalInstanceThreadLocal.get();
    }

}
```

## 破坏单例

### 序列化

- 如果没有添加 readResolve 方法，那么返回的是一个全新的对象，我们要避免这个行为，需要添加 readResolve

```java
        HungrySingleton instance = HungrySingleton.getInstance();


        ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream("singleton_file"));
        oos.writeObject(instance);

        File file = new File("singleton_file");
        ObjectInputStream ois = new ObjectInputStream(new FileInputStream(file));

        HungrySingleton newInstance = (HungrySingleton) ois.readObject();
        System.out.println(instance;
        System.out.println(newInstance);
        System.out.println(instance == newInstance);
```

### 反射攻击

- 通过在构造器加入判断来避免

## 源码

- Runtime 类 getRuntime 方法，通过饿汉式实现单例
- Desktop awt 的 getDesktop，很像容器单例

# 原型模式

## 定义

![](image/Pasted%20image%2020241227211536.png)

## 适用场景

![](image/Pasted%20image%2020241227212428.png)

## 优点

![](image/Pasted%20image%2020241227212442.png)

## 缺点

![](image/Pasted%20image%2020241227212528.png)

## 扩展

![](image/Pasted%20image%2020241227212628.png)

## 代码

```java
public class Test {
    public static void main(String[] args) throws CloneNotSupportedException {
        Mail mail = new Mail();
        mail.setContent("初始化模板");
        System.out.println("初始化mail:"+mail);
        for(int i = 0;i < 10;i++){
            Mail mailTemp = (Mail) mail.clone();
            mailTemp.setName("姓名"+i);
            mailTemp.setEmailAddress("姓名"+i+"@imooc.com");
            mailTemp.setContent("恭喜您，此次慕课网活动中奖了");
            MailUtil.sendMail(mailTemp);
            System.out.println("克隆的mailTemp:"+mailTemp);
        }
        MailUtil.saveOriginMailRecord(mail);
    }
}

public class Mail implements Cloneable{
    private String name;
    private String emailAddress;
    private String content;
    public Mail(){
        System.out.println("Mail Class Constructor");
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getEmailAddress() {
        return emailAddress;
    }

    public void setEmailAddress(String emailAddress) {
        this.emailAddress = emailAddress;
    }

    public String getContent() {
        return content;
    }

    public void setContent(String content) {
        this.content = content;
    }

    @Override
    public String toString() {
        return "Mail{" +
                "name='" + name + '\'' +
                ", emailAddress='" + emailAddress + '\'' +
                ", content='" + content + '\'' +
                '}'+super.toString();
    }

    @Override
    protected Object clone() throws CloneNotSupportedException {
        System.out.println("clone mail object");
        return super.clone();
    }
}

public class MailUtil {
    public static void sendMail(Mail mail){
        String outputContent = "向{0}同学,邮件地址:{1},邮件内容:{2}发送邮件成功";
        System.out.println(MessageFormat.format(outputContent,mail.getName(),mail.getEmailAddress(),mail.getContent()));
    }
    public static void saveOriginMailRecord(Mail mail){
        System.out.println("存储originMail记录,originMail:"+mail.getContent());
    }
}

public class B extends A {
    public static void main(String[] args) throws CloneNotSupportedException {
        B b = new B();
        b.clone();
    }
}

public abstract class A implements Cloneable{
    @Override
    protected Object clone() throws CloneNotSupportedException {
        return super.clone();
    }
}
```

## 单例模式实现 cloneable 接口

- 需要修改 clone 方式，直接返回单例实例

## 源码

- 看实现了 cloneable 接口