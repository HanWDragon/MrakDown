# 什么是不变性（Immutable）

![](image/Pasted%20image%2020220205103714.png)

```java
package immutable;

/**
 * 描述：     不可变的对象，演示其他类无法修改这个对象，public也不行
 */
public class Person {

    final int age = 18;
      String alice = new String("Alice");
    final String name = alice;
    final TestFinal testFinal = new TestFinal();
    public static void main(String[] args) {
        Person person = new Person();
        person.alice = "44";
        System.out.println(person.name);
    }
}


```

```java
package immutable;

/**
 * 描述：     测试final能否被修改
 */
public class TestFinal {

    String test;

    public static void main(String[] args) {
        final Person person = new Person();
        person.testFinal.test = "13g";
        System.out.println(person.testFinal.test);
        person.testFinal.test = "15g";
        System.out.println(person.testFinal.test);

//        String abc = "abc";
//        System.out.println(abc.substring(1, 2));
//        System.out.println(abc);
//        person.bag = "book";
//        person = new Person();
//        int age = person.age;
//        String name = person.name;

    }
}

```

![](image/Pasted%20image%2020220205105838.png)

# final的作用

![](image/Pasted%20image%2020220205110036.png)

![](image/Pasted%20image%2020220205110120.png)



# final的3种用法

![](image/Pasted%20image%2020220205111022.png)

## final修饰变量

![](image/Pasted%20image%2020220205110749.png)

### 赋值时机

![](image/Pasted%20image%2020220205111149.png)

![](image/Pasted%20image%2020220205111225.png)

![](image/Pasted%20image%2020220205111534.png)

![](image/Pasted%20image%2020220205111703.png)

```java
package immutable;

/**
 * 描述：     演示final变量
 */
public class FinalVariableDemo {

    private static final Person person = null;

//    void testFinal() {
//       final int b = 7;
//        int c =b;
//    }
//    public FinalVariableDemo() {
//    }
//    public FinalVariableDemo(int a) {
////        this.a = a;
////    }
//
//    static {
//        a = 7;
//    }
}

```

### 为什么要规定赋值时机

![](image/Pasted%20image%2020220205112339.png)

## final修饰方法

![](image/Pasted%20image%2020220205112353.png)

```java
package immutable;

/**
 * 描述：     final的方法
 */
public class FinalMethodDemo {

    public void drink() {

    }

    public final void eat() {

    }

    public static void sleep() {

    }
}

class SubClass extends FinalMethodDemo {

    @Override
    public void drink() {
        super.drink();
        eat();
    }

//    public final void eat() {
//
//    }
    public static void sleep() {

    }
}
```

## final修饰类

![](image/Pasted%20image%2020220205113215.png)

# final的注意点

![](image/Pasted%20image%2020220205113338.png)

# 不变性和final的关系

![](image/Pasted%20image%2020220205113540.png)

![](image/Pasted%20image%2020220205114109.png)

![](image/Pasted%20image%2020220205114150.png)

```java
package immutable;

import java.util.HashSet;
import java.util.Set;

/**
 * 描述：     一个属性是对象，但是整体不可变，其他类无法修改set里面的数据
 */
public class ImmutableDemo {

    private final Set<String> students = new HashSet<>();

    public ImmutableDemo() {
        students.add("李小美");
        students.add("王壮");
        students.add("徐福记");
    }

    public boolean isStudent(String name) {
        return students.contains(name);
    }
}

```

# 栈封闭

![](image/Pasted%20image%2020220205114223.png)

```java
package immutable;

/**
 * 描述：     演示栈封闭的两种情况，基本变量和对象 先演示线程争抢带来错误结果，然后把变量放到方法内，情况就变了
 */
public class StackConfinement implements Runnable {

    int index = 0;

    public void inThread() {
        int neverGoOut = 0;
        synchronized (this) {
            for (int i = 0; i < 10000; i++) {
                neverGoOut++;
            }
        }

        System.out.println("栈内保护的数字是线程安全的：" + neverGoOut);
    }

    @Override
    public void run() {
        for (int i = 0; i < 10000; i++) {
            index++;
        }
        inThread();
    }

    public static void main(String[] args) throws InterruptedException {
        StackConfinement r1 = new StackConfinement();
        Thread thread1 = new Thread(r1);
        Thread thread2 = new Thread(r1);
        thread1.start();
        thread2.start();
        thread1.join();
        thread2.join();
        System.out.println(r1.index);
    }
}

```

# 面试题

```java
package immutable;

/**
 * 描述：     TODO
 */
public class FinalStringDemo1 {

    public static void main(String[] args) {
        String a = "wukong2";
        final String b = "wukong";
        String d = "wukong";
        String c = b + 2;
        String e = d + 2;
        System.out.println((a == c));
        System.out.println((a == e));
    }
}

```

```java
package immutable;

/**
 * 描述：     TODO
 */
public class FinalStringDemo2 {

    public static void main(String[] args) {
        String a = "wukong2";
        final String b = getDashixiong();
        String c = b + 2;
        System.out.println(a == c);

    }

    private static String getDashixiong() {
        return "wukong";
    }
}

```