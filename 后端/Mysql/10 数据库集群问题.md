# 切换：保业务还是保数据

## 如何进行身份切换

![](image/Pasted%20image%2020220309221245.png)

## 可靠性优先策略

![](image/Pasted%20image%2020220310150752.png)

![](image/Pasted%20image%2020220310150817.png)

## 可用性优先策略

![](image/Pasted%20image%2020220310150903.png)

![](image/Pasted%20image%2020220310151002.png)

## 总结

![](image/Pasted%20image%2020220310151046.png)

# 数据库切换了，业务怎么办

## 业务切换到新地址

![](image/Pasted%20image%2020220310151249.png)

![](image/Pasted%20image%2020220310151231.png)

## 使用内部DNS，使用域名连接

![](image/Pasted%20image%2020220310151549.png)

![](image/Pasted%20image%2020220310151532.png)

## VIP漂移

![](image/Pasted%20image%2020220310151715.png)

## 使用代理

![](image/Pasted%20image%2020220310151818.png)

## 使用dble的主备切换

![](image/Pasted%20image%2020220310151936.png)

## 总结

![](image/Pasted%20image%2020220310152052.png)

# 如何实现自动主从切换

##  Keepalived

 ![](image/Pasted%20image%2020220310152252.png)
##  MHA（Master High Availability）

![](image/Pasted%20image%2020220310152525.png)

![](image/Pasted%20image%2020220310152750.png)

![](image/Pasted%20image%2020220310152803.png)

![](image/Pasted%20image%2020220310152842.png)

![](image/Pasted%20image%2020220310152931.png)

![](image/Pasted%20image%2020220310152942.png)

![](image/Pasted%20image%2020220310152553.png)

## 自研高可用组件

![](image/Pasted%20image%2020220310153221.png)

## 总结

![](image/Pasted%20image%2020220310153246.png)

# 高可用了，集群为什么还会挂

## DRDS（Distributed Relational Database Service）

![](image/Pasted%20image%2020220310153627.png)

![](image/Pasted%20image%2020220310153858.png)

![](image/Pasted%20image%2020220310154052.png)

![](image/Pasted%20image%2020220310154325.png)

![](image/Pasted%20image%2020220310154440.png)

![](image/Pasted%20image%2020220310154603.png)

![](image/Pasted%20image%2020220310154810.png)

## 总结

![](image/Pasted%20image%2020220310155250.png)

# 本章小结

## 切换策略

![](image/Pasted%20image%2020220310155423.png)

## 如何切换业务

![](image/Pasted%20image%2020220310155521.png)

## 如何自动切换数据库身份

![](image/Pasted%20image%2020220310155708.png)

## 最后一个单点问题

![](image/Pasted%20image%2020220310155957.png)